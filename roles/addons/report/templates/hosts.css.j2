{% for rack in (groups | select('match','^rack_.*') | list | unique | sort) %}
{% if groups[rack][0] is defined and hostvars[groups[rack][0]]['rack_x_span'] is defined and hostvars[groups[rack][0]]['rack_z_span'] is defined %}
.{{rack}} {
  display: grid;
  grid-template-columns: {% for i in range(hostvars[groups[rack][0]]['rack_x_span']) %}80px {% endfor %};
  grid-template-rows: {% for i in range(hostvars[groups[rack][0]]['rack_z_span']) %}20px {% endfor %};
  grid-gap: 4px;
  background-color: #2196F3;
}

.{{rack}} > div {
  background-color: rgba(255, 255, 255, 0.8);
  text-align: center;
  display: flex;
  justify-content: center;
  align-items: center;
}

.{{rack}}_container {
background-color: #333;
width: {{ (hostvars[groups[rack][0]]['rack_x_span']*80) + ((hostvars[groups[rack][0]]['rack_x_span']-1)*4) + 20 }}px;
height: {{ (hostvars[groups[rack][0]]['rack_z_span']*20) + ((hostvars[groups[rack][0]]['rack_z_span']-1)*4) + 20 }}px;
padding: 10px 10px;
}

{% for host in groups[rack] %}
{% if hostvars[host]['x_p'] is defined and hostvars[host]['z_p'] is defined and hostvars[host]['x_span'] is defined and hostvars[host]['z_span'] is defined %}
.{{host}} {
  grid-column: {{hostvars[host]['x_p']}} / span {{hostvars[host]['x_span']}};
  grid-row: {{hostvars[host]['z_p']}} / span {{hostvars[host]['z_span']}};
}
{% endif %}
{% endfor %}

{% endif %}
{% endfor %}


